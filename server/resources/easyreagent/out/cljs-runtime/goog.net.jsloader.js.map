{
"version":3,
"file":"goog.net.jsloader.js",
"lineCount":146,
"mappings":"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",
"sources":["goog/net/jsloader.js"],
"sourcesContent":["/**\n * @license\n * Copyright The Closure Library Authors.\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview A utility to load JavaScript files via DOM script tags.\n * Refactored from goog.net.Jsonp. Works cross-domain.\n */\n\ngoog.provide('goog.net.jsloader');\ngoog.provide('goog.net.jsloader.Error');\ngoog.provide('goog.net.jsloader.ErrorCode');\ngoog.provide('goog.net.jsloader.Options');\n\ngoog.require('goog.array');\ngoog.require('goog.async.Deferred');\ngoog.require('goog.debug.Error');\ngoog.require('goog.dom');\ngoog.require('goog.dom.DomHelper');\ngoog.require('goog.dom.TagName');\ngoog.require('goog.dom.safe');\ngoog.require('goog.html.TrustedResourceUrl');\ngoog.require('goog.object');\n\n\n/**\n * The name of the property of goog.global under which the JavaScript\n * verification object is stored by the loaded script.\n * @private {string}\n */\ngoog.net.jsloader.GLOBAL_VERIFY_OBJS_ = 'closure_verification';\n\n\n/**\n * The default length of time, in milliseconds, we are prepared to wait for a\n * load request to complete.\n * @type {number}\n */\ngoog.net.jsloader.DEFAULT_TIMEOUT = 5000;\n\n\n/**\n * Optional parameters for goog.net.jsloader.send.\n * timeout: The length of time, in milliseconds, we are prepared to wait\n *     for a load request to complete, or 0 or negative for no timeout. Default\n *     is 5 seconds.\n * document: The HTML document under which to load the JavaScript. Default is\n *     the current document.\n * cleanupWhenDone: If true clean up the script tag after script completes to\n *     load. This is important if you just want to read data from the JavaScript\n *     and then throw it away. Default is false.\n * attributes: Additional attributes to set on the script tag.\n *\n * @typedef {{\n *   timeout: (number|undefined),\n *   document: (HTMLDocument|undefined),\n *   cleanupWhenDone: (boolean|undefined),\n *   attributes: (!Object<string, string>|undefined)\n * }}\n */\ngoog.net.jsloader.Options;\n\n\n/**\n * Scripts (URIs) waiting to be loaded.\n * @private {!Array<!goog.html.TrustedResourceUrl>}\n */\ngoog.net.jsloader.scriptsToLoad_ = [];\n\n\n/**\n * The deferred result of loading the URIs in scriptsToLoad_.\n * We need to return this to a caller that wants to load URIs while\n * a deferred is already working on them.\n * @private {!goog.async.Deferred<null>}\n */\ngoog.net.jsloader.scriptLoadingDeferred_;\n\n\n\n/**\n * Loads and evaluates the JavaScript files at the specified URIs, guaranteeing\n * the order of script loads.\n *\n * Because we have to load the scripts in serial (load script 1, exec script 1,\n * load script 2, exec script 2, and so on), this will be slower than doing\n * the network fetches in parallel.\n *\n * If you need to load a large number of scripts but dependency order doesn't\n * matter, you should just call goog.net.jsloader.safeLoad N times.\n *\n * If you need to load a large number of scripts on the same domain,\n * you may want to use goog.module.ModuleLoader.\n *\n * @param {Array<!goog.html.TrustedResourceUrl>} trustedUris The URIs to load.\n * @param {goog.net.jsloader.Options=} opt_options Optional parameters. See\n *     goog.net.jsloader.options documentation for details.\n * @return {!goog.async.Deferred} The deferred result, that may be used to add\n *     callbacks\n */\ngoog.net.jsloader.safeLoadMany = function(trustedUris, opt_options) {\n  'use strict';\n  // Loading the scripts in serial introduces asynchronosity into the flow.\n  // Therefore, there are race conditions where client A can kick off the load\n  // sequence for client B, even though client A's scripts haven't all been\n  // loaded yet.\n  //\n  // To work around this issue, all module loads share a queue.\n  if (!trustedUris.length) {\n    return goog.async.Deferred.succeed(null);\n  }\n\n  const isAnotherModuleLoading = goog.net.jsloader.scriptsToLoad_.length;\n  goog.array.extend(goog.net.jsloader.scriptsToLoad_, trustedUris);\n  if (isAnotherModuleLoading) {\n    // jsloader is still loading some other scripts.\n    // In order to prevent the race condition noted above, we just add\n    // these URIs to the end of the scripts' queue and return the deferred\n    // result of the ongoing script load, so the caller knows when they\n    // finish loading.\n    return goog.net.jsloader.scriptLoadingDeferred_;\n  }\n\n  trustedUris = goog.net.jsloader.scriptsToLoad_;\n  const popAndLoadNextScript = function() {\n    'use strict';\n    const trustedUri = trustedUris.shift();\n    const deferred = goog.net.jsloader.safeLoad(trustedUri, opt_options);\n    if (trustedUris.length) {\n      deferred.addBoth(popAndLoadNextScript);\n    }\n    return deferred;\n  };\n  goog.net.jsloader.scriptLoadingDeferred_ = popAndLoadNextScript();\n  return goog.net.jsloader.scriptLoadingDeferred_;\n};\n\n\n/**\n * Loads and evaluates a JavaScript file.\n * When the script loads, a user callback is called.\n * It is the client's responsibility to verify that the script ran successfully.\n *\n * @param {!goog.html.TrustedResourceUrl} trustedUri The URI of the JavaScript.\n * @param {goog.net.jsloader.Options=} opt_options Optional parameters. See\n *     goog.net.jsloader.Options documentation for details.\n * @return {!goog.async.Deferred} The deferred result, that may be used to add\n *     callbacks and/or cancel the transmission.\n *     The error callback will be called with a single goog.net.jsloader.Error\n *     parameter.\n */\ngoog.net.jsloader.safeLoad = function(trustedUri, opt_options) {\n  'use strict';\n  const options = opt_options || /** @type {!goog.net.jsloader.Options} */ ({});\n  const doc = options.document || document;\n  const uri = goog.html.TrustedResourceUrl.unwrap(trustedUri);\n\n  const script =\n      new goog.dom.DomHelper(doc).createElement(goog.dom.TagName.SCRIPT);\n  const request = {script_: script, timeout_: undefined};\n  const deferred = new goog.async.Deferred(goog.net.jsloader.cancel_, request);\n\n  // Set a timeout.\n  let timeout = null;\n  const timeoutDuration = (options.timeout != null) ?\n      options.timeout :\n      goog.net.jsloader.DEFAULT_TIMEOUT;\n  if (timeoutDuration > 0) {\n    timeout = window.setTimeout(function() {\n      'use strict';\n      goog.net.jsloader.cleanup_(script, true);\n      deferred.errback(\n          new goog.net.jsloader.Error(\n              goog.net.jsloader.ErrorCode.TIMEOUT,\n              'Timeout reached for loading script ' + uri));\n    }, timeoutDuration);\n    request.timeout_ = timeout;\n  }\n\n  // Hang the user callback to be called when the script completes to load.\n  // NOTE(user): This callback will be called in IE even upon error. In any\n  // case it is the client's responsibility to verify that the script ran\n  // successfully.\n  script.onload = script.onreadystatechange = function() {\n    'use strict';\n    if (!script.readyState || script.readyState == 'loaded' ||\n        script.readyState == 'complete') {\n      const removeScriptNode = options.cleanupWhenDone || false;\n      goog.net.jsloader.cleanup_(script, removeScriptNode, timeout);\n      deferred.callback(null);\n    }\n  };\n\n  // Add an error callback.\n  // NOTE(user): Not supported in IE.\n  script.onerror = function() {\n    'use strict';\n    goog.net.jsloader.cleanup_(script, true, timeout);\n    deferred.errback(\n        new goog.net.jsloader.Error(\n            goog.net.jsloader.ErrorCode.LOAD_ERROR,\n            'Error while loading script ' + uri));\n  };\n\n  const properties = options.attributes || {};\n  goog.object.extend(\n      properties, {'type': 'text/javascript', 'charset': 'UTF-8'});\n  goog.dom.setProperties(script, properties);\n  // NOTE(user): Safari never loads the script if we don't set the src\n  // attribute before appending.\n  goog.dom.safe.setScriptSrc(script, trustedUri);\n  const scriptParent = goog.net.jsloader.getScriptParentElement_(doc);\n  scriptParent.appendChild(script);\n\n  return deferred;\n};\n\n\n/**\n * Loads a JavaScript file and verifies it was evaluated successfully, using a\n * verification object.\n * The verification object is set by the loaded JavaScript at the end of the\n * script.\n * We verify this object was set and return its value in the success callback.\n * If the object is not defined we trigger an error callback.\n *\n * @param {!goog.html.TrustedResourceUrl} trustedUri The URI of the JavaScript.\n * @param {string} verificationObjName The name of the verification object that\n *     the loaded script should set.\n * @param {goog.net.jsloader.Options} options Optional parameters. See\n *     goog.net.jsloader.Options documentation for details.\n * @return {!goog.async.Deferred} The deferred result, that may be used to add\n *     callbacks and/or cancel the transmission.\n *     The success callback will be called with a single parameter containing\n *     the value of the verification object.\n *     The error callback will be called with a single goog.net.jsloader.Error\n *     parameter.\n */\ngoog.net.jsloader.safeLoadAndVerify = function(\n    trustedUri, verificationObjName, options) {\n  'use strict';\n  // Define the global objects variable.\n  if (!goog.global[goog.net.jsloader.GLOBAL_VERIFY_OBJS_]) {\n    goog.global[goog.net.jsloader.GLOBAL_VERIFY_OBJS_] = {};\n  }\n  const verifyObjs = goog.global[goog.net.jsloader.GLOBAL_VERIFY_OBJS_];\n  const uri = goog.html.TrustedResourceUrl.unwrap(trustedUri);\n\n  // Verify that the expected object does not exist yet.\n  if (verifyObjs[verificationObjName] !== undefined) {\n    // TODO(user): Error or reset variable?\n    return goog.async.Deferred.fail(\n        new goog.net.jsloader.Error(\n            goog.net.jsloader.ErrorCode.VERIFY_OBJECT_ALREADY_EXISTS,\n            'Verification object ' + verificationObjName +\n                ' already defined.'));\n  }\n\n  // Send request to load the JavaScript.\n  const sendDeferred = goog.net.jsloader.safeLoad(trustedUri, options);\n\n  // Create a deferred object wrapping the send result.\n  const deferred =\n      new goog.async.Deferred(goog.bind(sendDeferred.cancel, sendDeferred));\n\n  // Call user back with object that was set by the script.\n  sendDeferred.addCallback(function() {\n    'use strict';\n    const result = verifyObjs[verificationObjName];\n    if (result !== undefined) {\n      deferred.callback(result);\n      delete verifyObjs[verificationObjName];\n    } else {\n      // Error: script was not loaded properly.\n      deferred.errback(\n          new goog.net.jsloader.Error(\n              goog.net.jsloader.ErrorCode.VERIFY_ERROR, 'Script ' + uri +\n                  ' loaded, but verification object ' + verificationObjName +\n                  ' was not defined.'));\n    }\n  });\n\n  // Pass error to new deferred object.\n  sendDeferred.addErrback(function(error) {\n    'use strict';\n    if (verifyObjs[verificationObjName] !== undefined) {\n      delete verifyObjs[verificationObjName];\n    }\n    deferred.errback(error);\n  });\n\n  return deferred;\n};\n\n\n/**\n * Gets the DOM element under which we should add new script elements.\n * How? Take the first head element, and if not found take doc.documentElement,\n * which always exists.\n *\n * @param {!HTMLDocument} doc The relevant document.\n * @return {!Element} The script parent element.\n * @private\n */\ngoog.net.jsloader.getScriptParentElement_ = function(doc) {\n  'use strict';\n  const headElements =\n      goog.dom.getElementsByTagName(goog.dom.TagName.HEAD, doc);\n  if (!headElements || headElements.length === 0) {\n    return doc.documentElement;\n  } else {\n    return headElements[0];\n  }\n};\n\n\n/**\n * Cancels a given request.\n * @this {{script_: Element, timeout_: number}} The request context.\n * @private\n */\ngoog.net.jsloader.cancel_ = function() {\n  'use strict';\n  const request = this;\n  if (request && request.script_) {\n    const scriptNode = request.script_;\n    if (scriptNode && scriptNode.tagName == goog.dom.TagName.SCRIPT) {\n      goog.net.jsloader.cleanup_(scriptNode, true, request.timeout_);\n    }\n  }\n};\n\n\n/**\n * Removes the script node and the timeout.\n * @param {Node} scriptNode The node to be cleaned up.\n * @param {boolean} removeScriptNode If true completely remove the script node.\n * @param {?number=} opt_timeout The timeout handler to cleanup.\n * @private\n * @suppress {strictMissingProperties} Part of the go/strict_warnings_migration\n */\ngoog.net.jsloader.cleanup_ = function(\n    scriptNode, removeScriptNode, opt_timeout) {\n  'use strict';\n  if (opt_timeout != null) {\n    goog.global.clearTimeout(opt_timeout);\n  }\n\n  scriptNode.onload = () => {};\n  scriptNode.onerror = () => {};\n  scriptNode.onreadystatechange = () => {};\n\n  // Do this after a delay (removing the script node of a running script can\n  // confuse older IEs).\n  if (removeScriptNode) {\n    window.setTimeout(function() {\n      'use strict';\n      goog.dom.removeNode(scriptNode);\n    }, 0);\n  }\n};\n\n\n/**\n * Possible error codes for jsloader.\n * @enum {number}\n */\ngoog.net.jsloader.ErrorCode = {\n  LOAD_ERROR: 0,\n  TIMEOUT: 1,\n  VERIFY_ERROR: 2,\n  VERIFY_OBJECT_ALREADY_EXISTS: 3,\n};\n\n\n\n/**\n * A jsloader error.\n *\n * @param {goog.net.jsloader.ErrorCode} code The error code.\n * @param {string=} opt_message Additional message.\n * @constructor\n * @extends {goog.debug.Error}\n * @final\n */\ngoog.net.jsloader.Error = function(code, opt_message) {\n  'use strict';\n  let msg = 'Jsloader error (code #' + code + ')';\n  if (opt_message) {\n    msg += ': ' + opt_message;\n  }\n  goog.net.jsloader.Error.base(this, 'constructor', msg);\n\n  /**\n   * The code for this error.\n   *\n   * @type {goog.net.jsloader.ErrorCode}\n   */\n  this.code = code;\n};\ngoog.inherits(goog.net.jsloader.Error, goog.debug.Error);\n"],
"names":["goog","provide","require","net","jsloader","GLOBAL_VERIFY_OBJS_","DEFAULT_TIMEOUT","Options","scriptsToLoad_","scriptLoadingDeferred_","safeLoadMany","goog.net.jsloader.safeLoadMany","trustedUris","opt_options","length","async","Deferred","succeed","isAnotherModuleLoading","array","extend","popAndLoadNextScript","trustedUri","shift","deferred","safeLoad","addBoth","goog.net.jsloader.safeLoad","options","doc","document","uri","html","TrustedResourceUrl","unwrap","script","createElement","dom","DomHelper","TagName","SCRIPT","request","script_","timeout_","undefined","cancel_","timeout","timeoutDuration","window","setTimeout","cleanup_","errback","Error","ErrorCode","TIMEOUT","onload","onreadystatechange","script.onreadystatechange","readyState","removeScriptNode","cleanupWhenDone","callback","onerror","script.onerror","LOAD_ERROR","properties","attributes","object","setProperties","safe","setScriptSrc","scriptParent","getScriptParentElement_","appendChild","safeLoadAndVerify","goog.net.jsloader.safeLoadAndVerify","verificationObjName","global","verifyObjs","fail","VERIFY_OBJECT_ALREADY_EXISTS","sendDeferred","bind","cancel","addCallback","result","VERIFY_ERROR","addErrback","error","goog.net.jsloader.getScriptParentElement_","headElements","getElementsByTagName","HEAD","documentElement","goog.net.jsloader.cancel_","scriptNode","tagName","goog.net.jsloader.cleanup_","opt_timeout","clearTimeout","scriptNode.onload","scriptNode.onerror","scriptNode.onreadystatechange","removeNode","goog.net.jsloader.Error","code","opt_message","msg","base","inherits","debug"]
}
